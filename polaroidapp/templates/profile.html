{% extends 'base.html' %}
{% load static %}

{% block content %}
 <style>
     body {
        background-image: linear-gradient(to right, #e2dbd5, #efede0) !important;
     }
 </style>

 <form action="{% url 'profile' %}" method="POST" enctype="multipart/form-data">
     {% csrf_token %}
     {{form}}
     <button class="btn btn-outline-success" type="submit">Upload</button>
 </form>

    <div class="card" style="width: 18rem;">
        <img class="card-img-top" src="{{profile.profile_photo.url}}" alt="Card image cap">
        <div class="card-body">
            <p class="card-text">Username: {{profile.user}}</p>
            <p class="card-text">Bio: {{profile.bio}}</p>
        </div>
    </div>

    <p class="uploads h2">Uploads</p>

    {% for image in images %}
    <div class="card" style="width: 18rem;">
        <img class="card-img-top" src="{{image.uploaded_image.url}}" alt="Card image cap">
        <div class="icons my-1 mp-1 d-flex justify-content-start">
            <button onclick="likecount('{{image.id}}')" class="btn"><img style="width: 2rem;" src="../../media/images/heart.png" alt=""><span id="clicks">{{image.likes}}</span></button>
            <button onclick="textarea()" class="btn"><img style="width: 2rem" src="../../media/images/chat.png" alt=""></button>
        </div>
        <div class="card-body">
            <p class="card-text">{{image.image_name}}</p>
            <p class="card-text">{{image.caption}}</p>
        </div>
    </div>
    {% endfor %}

    <script>

        function textarea() {
            let form = document.createElement("form");
            form.setAttribute('method','post');
            // form.setAttribute('action','');

            let token = document.createElement('input');
            token.setAttribute('name','csrfmiddlewaretoken');
            token.setAttribute('type', 'hidden');
            token.setAttribute('value','{{csrf_token}}');
            
            let cinput = document.createElement('input');
            cinput.setAttribute('type','text');
            cinput.setAttribute('placeholder','Comment here...');
            cinput.setAttribute('name','comment');

            let sbutton = document.createElement('input');
            sbutton.setAttribute('type','submit');
            sbutton.setAttribute('value','submit');

            form.append(sbutton);
            form.append(cinput);
            form.append(token);
            document.body.appendChild(form);
        }

        function likecount(image_id) {
            /*
            |image_id|csrftoken|
            |    1   |   1234  |
            */
            
            let count = {
                csrfmiddlewaretoken: '{{csrf_token}}',
                image_id: image_id,
            };
            $.post('/likes/',count,function(data){
                if(data.liked) {
                    $('#clicks').html(data.likes)
                }
            })

        }

    </script>

{% endblock %}